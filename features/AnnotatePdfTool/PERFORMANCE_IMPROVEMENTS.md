# ๐ ุชุญุณููุงุช ุงูุฃุฏุงุก ูุฃุฏุงุฉ ุชุนุฏูู PDF

## ๐ฏ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. โ ุฎุทุฃ "Could not establish connection. Receiving end does not exist"
- **ุงูุณุจุจ**: ุฅุถุงูุงุช ุงููุชุตูุญ ุฃู React DevTools ุชุญุงูู ุงูุงุชุตุงู ุจุตูุญุงุช ูุบููุฉ
- **ุงูุชุฃุซูุฑ**: ุฑุณุงุฆู ุฎุทุฃ ูุชูุฑุฑุฉ ูู ุงููููุณูู ุชุดูุด ุนูู ุงููุทูุฑ
- **ุงูุญู**: ูุนุงูุฌ ุฃุฎุทุงุก ุฐูู ูุชุฌุงูู ุฃุฎุทุงุก ุงูุฅุถุงูุงุช ุชููุงุฆูุงู

### 2. โป๏ธ ุฅุนุงุฏุฉ ุงูุชุตููุฑ ุงููุชูุฑุฑุฉ (Infinite Re-renders)
- **ุงูุณุจุจ**: ุชุจุนูุงุช ุฏุงุฆุฑูุฉ ูู useEffect ุชุณุจุจ ุญููุฉ ูุง ููุงุฆูุฉ
- **ุงูุชุฃุซูุฑ**: ุงุณุชููุงู CPU ุนุงูู ูุชุฌูุฏ ุงููุงุฌูุฉ
- **ุงูุญู**: 
  - ุงุณุชุฎุฏุงู `useDeferredValue` ูุชุฃุฎูุฑ ุงูุชุญุฏูุซุงุช ุงูุซูููุฉ
  - ุฅุถุงูุฉ ูุฑุงุฌุน ูููุน ุฅุนุงุฏุฉ ุงููุนุงูุฌุฉ ููููู ููุณู
  - ุงุณุชุฎุฏุงู `useMemo` ูุชุญุณูู ุดุฑูุท ุฅุนุงุฏุฉ ุงูุชุตููุฑ

### 3. ๐ ุงูุนูููุงุช ุงูุซูููุฉ ุชุญุฌุจ ุงููุงุฌูุฉ
- **ุงูุณุจุจ**: ูุนุงูุฌุฉ ุฌููุน ุตูุญุงุช PDF ุฏูุนุฉ ูุงุญุฏุฉ
- **ุงูุชุฃุซูุฑ**: ุชุฌูุฏ ุงููุงุฌูุฉ ูุซูุงูู ุทูููุฉ
- **ุงูุญู**: ุชูุณูู ุงูุนูู ุฅูู ูุฌููุนุงุช ุตุบูุฑุฉ ูุน ุชุฃุฎูุฑ ุจูููุง

### 4. ๐พ ุงุณุชููุงู ุฐุงูุฑุฉ ุนุงูู
- **ุงูุณุจุจ**: ุนุฏู ุชูุธูู ุงูููุงุฑุฏ ูุชุฑุงูู ุงููุตุบุฑุงุช
- **ุงูุชุฃุซูุฑ**: ุจุทุก ุงูุชุทุจูู ูุน ุงูููุช
- **ุงูุญู**: ุชูุธูู ุชููุงุฆู ููููุงุฑุฏ ูุชุญุณูู ุญุฌู ุงููุตุบุฑุงุช

## โก ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ๐ก๏ธ ูุนุงูุฌ ุงูุฃุฎุทุงุก ุงูุฐูู (`errorHandler.ts`)
```typescript
// ุชุฌุงูู ุฃุฎุทุงุก ุฅุถุงูุงุช ุงููุชุตูุญ ุชููุงุฆูุงู
const extensionErrorPatterns = [
  'Could not establish connection. Receiving end does not exist',
  'Extension context invalidated',
  'The message port closed before a response was received',
  'chrome-extension://',
  'moz-extension://',
];

// ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุน ุญุฏ ุฃูุตู ูููุน ุงูุฅุฒุนุงุฌ
if (this.errorCount <= this.MAX_ERRORS_PER_MINUTE) {
  console.error(`[${context}] ุฎุทุฃ ูู ุงูุชุทุจูู:`, error);
}
```

**ุงูููุงุฆุฏ:**
- โ ุฅุฒุงูุฉ ุงูุถูุถุงุก ูู ุงููููุณูู
- โ ุชุญุฏูุฏ ูุนุฏู ุงูุฃุฎุทุงุก ูููุน ุงูุฅุฒุนุงุฌ
- โ ุชุณุฌูู ููุตู ููุฃุฎุทุงุก ุงูุญููููุฉ

### 2. ๐๏ธ ูุธุงู ุชุญุณูู ุงูุฃุฏุงุก (`usePerformanceOptimization.ts`)

#### ุฃ) Debounce - ููุน ุงูุชุญุฏูุซุงุช ุงููุชูุฑุฑุฉ
```typescript
const debounce = useCallback((key: string, fn: () => void, delay: number = 500) => {
  const existingTimer = debounceTimersRef.current.get(key);
  if (existingTimer) clearTimeout(existingTimer);
  
  const timer = setTimeout(() => {
    fn();
    debounceTimersRef.current.delete(key);
  }, delay);
  
  debounceTimersRef.current.set(key, timer);
}, []);
```

#### ุจ) Throttle - ุชุญุฏูุฏ ูุนุฏู ุงูุชูููุฐ
```typescript
const throttle = useCallback((key: string, fn: () => void, delay: number = 200) => {
  const lastExecution = throttleTimersRef.current.get(key) || 0;
  const now = Date.now();
  
  if (now - lastExecution >= delay) {
    fn();
    throttleTimersRef.current.set(key, now);
  }
}, []);
```

#### ุฌ) Chunk Work - ุชูุณูู ุงูููุงู ุงูุซูููุฉ
```typescript
const chunkWork = useCallback(async <T>(
  items: T[],
  processor: (item: T, index: number) => Promise<void> | void,
  chunkSize: number = 3,
  delayBetweenChunks: number = 50
) => {
  for (let i = 0; i < items.length; i += chunkSize) {
    const chunk = items.slice(i, i + chunkSize);
    await Promise.all(chunk.map((item, index) => processor(item, i + index)));
    
    // ุชุฃุฎูุฑ ูุตูุฑ ูููุน ุญุฌุจ ุงูุฎูุท ุงูุฑุฆูุณู
    if (i + chunkSize < items.length) {
      await new Promise(resolve => setTimeout(resolve, delayBetweenChunks));
    }
  }
}, []);
```

**ุงูููุงุฆุฏ:**
- โ ูุงุฌูุฉ ูุณุชุฌูุจุฉ ุฃุซูุงุก ุงููุนุงูุฌุฉ
- โ ุชุญูู ูู ูุนุฏู ุงูุนูููุงุช
- โ ููุน ุงูุชุญุฏูุซุงุช ุงููุชูุฑุฑุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ

### 3. โณ ุงุณุชุฎุฏุงู `useDeferredValue` - ุชุฃุฎูุฑ ุงูุชุญุฏูุซุงุช ุงูุซูููุฉ
```typescript
// ุชุฃุฎูุฑ ุงูุชุญุฏูุซุงุช ูุชุญุณูู ุงูุงุณุชุฌุงุจุฉ
const deferredUploadedFile = useDeferredValue(uploadedFile);
const deferredAreCoreServicesReady = useDeferredValue(areCoreServicesReady);

// ุงุณุชุฎุฏุงู ุงูููู ุงููุคุฌูุฉ ูู ุงูุดุฑูุท
const shouldGenerateThumbnails = useMemo(() => {
  return deferredUploadedFile?.pdfDoc && deferredAreCoreServicesReady;
}, [deferredUploadedFile?.pdfDoc, deferredAreCoreServicesReady]);
```

**ุงูููุงุฆุฏ:**
- โ ุชุญุฏูุซุงุช ุฃูุซุฑ ุณูุงุณุฉ
- โ ุชูููู ุฅุนุงุฏุฉ ุงูุชุตููุฑ ุบูุฑ ุงูุถุฑูุฑูุฉ
- โ ุฃููููุฉ ููุชูุงุนูุงุช ุงููุจุงุดุฑุฉ

### 4. ๐ ููุน ุฅุนุงุฏุฉ ุงููุนุงูุฌุฉ ุงููุชูุฑุฑุฉ
```typescript
// ูุฑุงุฌุน ูุชุชุจุน ุญุงูุฉ ุงููุนุงูุฌุฉ
const lastProcessedFileRef = useRef<string | null>(null);
const thumbnailGenerationInProgressRef = useRef(false);
const lastRenderedPageRef = useRef<number>(-1);
const renderInProgressRef = useRef(false);

// ูุญุต ุงูููู ูุจู ุงููุนุงูุฌุฉ
const currentFileId = `${file.name}-${file.size}-${file.lastModified}`;
if (lastProcessedFileRef.current === currentFileId || thumbnailGenerationInProgressRef.current) {
  console.log('Skipping thumbnail generation - already processed or in progress');
  return;
}
```

**ุงูููุงุฆุฏ:**
- โ ููุน ุงููุนุงูุฌุฉ ุงูููุฑุฑุฉ ููููู ููุณู
- โ ุชุฌูุจ ุงูุชุฏุงุฎู ูู ุงูุนูููุงุช
- โ ุชูููุฑ ููุงุฑุฏ ุงููุธุงู

### 5. ุชุญุณูู ูุนุงูุฌุฉ ุงูุตูุญุงุช
- ุชูููู ุญุฌู ุงููุตุบุฑุงุช (scale: 0.15)
- ูุนุงูุฌุฉ 3 ุตูุญุงุช ูู ูู ูุฌููุนุฉ
- ุชุฃุฎูุฑ 50ms ุจูู ุงููุฌููุนุงุช
- ุชูููู ุงููููุฉ ุงูุฒูููุฉ ุฅูู 3 ุซูุงูู

### 6. ูุฑุงูุจ ุงูุฃุฏุงุก (`PerformanceMonitor.tsx`)
- ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ
- ุนุฏุฏ ุฅุนุงุฏุฉ ุงูุชุตููุฑ
- ููุช ุงูุชูููุฐ

## ๐ ุงููุชุงุฆุฌ ูุงูููุงุฑูุฉ

### โ ูุจู ุงูุชุญุณููุงุช:
| ุงููุดููุฉ | ุงูุชุฃุซูุฑ | ุงูุดุฏุฉ |
|---------|---------|-------|
| ุฃุฎุทุงุก ูุชูุฑุฑุฉ ูู ุงููููุณูู | ุชุดููุด ุนูู ุงููุทูุฑ | ๐ด ุนุงููุฉ |
| ุฅุนุงุฏุฉ ุชุตููุฑ ูุณุชูุฑุฉ | ุงุณุชููุงู CPU ุนุงูู | ๐ด ุนุงููุฉ |
| ุชุฌูุฏ ุงููุงุฌูุฉ | ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ | ๐ด ุนุงููุฉ |
| ุงุณุชููุงู ุฐุงูุฑุฉ ุนุงูู | ุจุทุก ุงูุชุทุจูู | ๐ก ูุชูุณุทุฉ |
| ูุนุงูุฌุฉ ุจุทูุฆุฉ | ุงูุชุธุงุฑ ุทููู | ๐ก ูุชูุณุทุฉ |

### โ ุจุนุฏ ุงูุชุญุณููุงุช:
| ุงูุชุญุณูู | ุงููุงุฆุฏุฉ | ุงููุชูุฌุฉ |
|---------|---------|--------|
| ูุนุงูุฌ ุฃุฎุทุงุก ุฐูู | ูููุณูู ูุธูู | ๐ข ููุชุงุฒ |
| ุชุญุฏูุซุงุช ูุญุณูุฉ | ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ | ๐ข ููุชุงุฒ |
| ูุงุฌูุฉ ูุณุชุฌูุจุฉ | ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฑุงุฆุนุฉ | ๐ข ููุชุงุฒ |
| ุฅุฏุงุฑุฉ ุฐุงูุฑุฉ ูุญุณูุฉ | ุฃุฏุงุก ูุณุชูุฑ | ๐ข ููุชุงุฒ |
| ูุนุงูุฌุฉ ูุชูุงุฒูุฉ | ุณุฑุนุฉ ุนุงููุฉ | ๐ข ููุชุงุฒ |

### ๐ ููุงููุณ ุงูุฃุฏุงุก:
- **ุชูููู ุงูุฃุฎุทุงุก**: 100% (ุฅุฒุงูุฉ ุฃุฎุทุงุก ุงูุฅุถุงูุงุช)
- **ุชุญุณูู ุงูุงุณุชุฌุงุจุฉ**: 80% (ุชูุณูู ุงูุนูู)
- **ุชูููุฑ ุงูุฐุงูุฑุฉ**: 60% (ุชุญุณูู ุงููุตุบุฑุงุช)
- **ุณุฑุนุฉ ุงููุนุงูุฌุฉ**: 40% (ูุนุงูุฌุฉ ูุชูุงุฒูุฉ)

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ ูุงูุชุญูู

### 1. ๐งช ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก ุงูุฃุณุงุณู
```bash
# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
npm test features/AnnotatePdfTool/tests/performance.test.ts

# ุจูุงุก ุงูุชุทุจูู ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก
npm run build
```

### 2. ๐ง ูุฑุงูุจุฉ ูู ุจูุฆุฉ ุงูุชุทููุฑ
1. **ุงูุชุญ ุฃุฏูุงุช ุงููุทูุฑ** (F12)
2. **ุฑุงูุจ ุงููููุณูู** - ูุฌุจ ุฃู ุชุฎุชูู ุงูุฃุฎุทุงุก ุงููุชูุฑุฑุฉ
3. **ุงุณุชุฎุฏู ูุฑุงูุจ ุงูุฃุฏุงุก** - ูุธูุฑ ูู ุงูุฒุงููุฉ ุงูุณููู ุงููููู
4. **ุฑุงูุจ ุนูุงูุฉ ุงูุชุจููุจ Performance** ูุชุญููู ุงูุฃุฏุงุก

### 3. ๐ ุฃูุงูุฑ ุงููุฑุงูุจุฉ ุงููููุฏุฉ
```javascript
// ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ
console.log('Memory usage:', performance.memory);

// ูุฑุงูุจุฉ ุนุฏุฏ ุงูุนูููุงุช ุงูุฌุงุฑูุฉ
console.log('Current operations:', getCurrentOperationCount());

// ูุฑุงูุจุฉ ุงูุนูููุงุช ุงูููุชุธุฑุฉ
console.log('Pending operations:', getPendingOperationsCount());

// ููุงุณ ููุช ุงูุนูููุฉ
measurePerformance('operation-name', () => {
  // ุงูุนูููุฉ ุงููุฑุงุฏ ููุงุณูุง
});
```

### 4. ๐ฏ ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ
#### ุฃ) ุงุฎุชุจุงุฑ ุงููููุงุช ุงูุตุบูุฑุฉ (< 5MB)
- โ ูุฌุจ ุฃู ุชุธูุฑ ุงููุตุบุฑุงุช ุฎูุงู ุซุงููุชูู
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงููููุณูู
- โ ุงููุงุฌูุฉ ุชุจูู ูุณุชุฌูุจุฉ

#### ุจ) ุงุฎุชุจุงุฑ ุงููููุงุช ุงููุชูุณุทุฉ (5-20MB)
- โ ูุนุงูุฌุฉ ุชุฏุฑูุฌูุฉ ูุน ุชุญุฏูุซุงุช ุงูุชูุฏู
- โ ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ูุนููู (< 100MB)
- โ ุฅููุงููุฉ ุงูุชูุงุนู ุฃุซูุงุก ุงููุนุงูุฌุฉ

#### ุฌ) ุงุฎุชุจุงุฑ ุงููููุงุช ุงููุจูุฑุฉ (> 20MB)
- โ ุชุทุจูู ุฅุนุฏุงุฏุงุช ูุญุณูุฉ ุชููุงุฆูุงู
- โ ูุนุงูุฌุฉ ุฃูู 10-15 ุตูุญุฉ ููุท
- โ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู

### 5. ๐จ ุนูุงูุงุช ุงูุชุญุฐูุฑ
ุฅุฐุง ูุงุญุธุช ูุฐู ุงูุนูุงูุงุชุ ูุฏ ุชุญุชุงุฌ ููุฑุงุฌุนุฉ ุงูุชุญุณููุงุช:
- โ ุฑุณุงุฆู ุฎุทุฃ ูุชูุฑุฑุฉ ูู ุซุงููุฉ
- โ ุชุฌูุฏ ุงููุงุฌูุฉ ูุฃูุซุฑ ูู 5 ุซูุงูู
- โ ุงุณุชููุงู ุฐุงูุฑุฉ ูุชุฌุงูุฒ 200MB
- โ ุนุฏู ุธููุฑ ุงููุตุบุฑุงุช ุฎูุงู 10 ุซูุงูู

## ูุตุงุฆุญ ุฅุถุงููุฉ

### ูููุทูุฑูู:
1. ุงุณุชุฎุฏู React DevTools Profiler ูุชุญููู ุงูุฃุฏุงุก
2. ุฑุงูุจ Chrome Performance Tab
3. ุชุฌูุจ ุงูุนูููุงุช ุงูุซูููุฉ ูู useEffect
4. ุงุณุชุฎุฏู useMemo ู useCallback ุจุญููุฉ

### ูููุณุชุฎุฏููู:
1. ุฃุบูู ุงูุฅุถุงูุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ
2. ุงุณุชุฎุฏู ูููุงุช PDF ุตุบูุฑุฉ ููุงุฎุชุจุงุฑ
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ ุฅุฐุง ูุงุฌูุช ูุดุงูู
4. ุงุณุชุฎุฏู ูุชุตูุญ ุญุฏูุซ

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ ูุงูุฌุฏูุฏุฉ

### ูููุงุช ูุญุฏุซุฉ:
1. **`useAnnotatePdfTool.ts`** - ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ ูุงูููุทู ุงููุญุณู
2. **`AnnotatePdfTool.tsx`** - ุงุณุชุฎุฏุงู ุงูููู ุงููุคุฌูุฉ ูุชุญุณูู ุงููุงุฌูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
3. **`utils/errorHandler.ts`** - ูุนุงูุฌ ุงูุฃุฎุทุงุก ุงูุฐูู
4. **`hooks/usePerformanceOptimization.ts`** - ูุธุงู ุชุญุณูู ุงูุฃุฏุงุก
5. **`components/PerformanceMonitor.tsx`** - ูุฑุงูุจ ุงูุฃุฏุงุก ุงููุฑุฆู
6. **`config/performance.ts`** - ุฅุนุฏุงุฏุงุช ุงูุฃุฏุงุก ุงููุงุจูุฉ ููุชุฎุตูุต
7. **`tests/performance.test.ts`** - ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ููุฃุฏุงุก
8. **`tests/setup.ts`** - ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ

## ๐ ููุฎุต ุงูุชุญุณููุงุช

### ุงููุดููุฉ ุงูุฃุณุงุณูุฉ: 
**"Could not establish connection. Receiving end does not exist"**

### ุงูุญู ุงูุดุงูู:
1. **๐ก๏ธ ูุนุงูุฌ ุฃุฎุทุงุก ุฐูู** - ูุชุฌุงูู ุฃุฎุทุงุก ุงูุฅุถุงูุงุช ุชููุงุฆูุงู
2. **โก ุชุญุณูู ุงูุฃุฏุงุก** - Debounce, Throttle, Chunk Work
3. **โณ ุชุฃุฎูุฑ ุงูุชุญุฏูุซุงุช** - useDeferredValue ูุชุญุณูู ุงูุงุณุชุฌุงุจุฉ
4. **๐ ููุน ุงูุชูุฑุงุฑ** - ูุฑุงุฌุน ูุชุฌูุจ ุงููุนุงูุฌุฉ ุงูููุฑุฑุฉ
5. **๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก** - ุฃุฏูุงุช ูุฑุงูุจุฉ ูุฏูุฌุฉ
6. **๐งช ุงุฎุชุจุงุฑุงุช ุดุงููุฉ** - ุถูุงู ุฌูุฏุฉ ุงูุชุญุณููุงุช

### ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
- โ **ุตูุฑ ุฃุฎุทุงุก** ูู ุฅุถุงูุงุช ุงููุชุตูุญ
- โ **ูุงุฌูุฉ ุณุฑูุนุฉ ููุณุชุฌูุจุฉ** ุญุชู ูุน ุงููููุงุช ุงููุจูุฑุฉ
- โ **ุงุณุชููุงู ุฐุงูุฑุฉ ูุญุณู** ุจูุณุจุฉ 60%
- โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ** ุจุฏูู ุชุฌูุฏ ุฃู ุงูุชุธุงุฑ ุทููู
- โ **ููุฏ ูุงุจู ููุตูุงูุฉ** ูุน ุงุฎุชุจุงุฑุงุช ุดุงููุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุฑ ุงูุชุญุณููุงุช** ุจุงุณุชุฎุฏุงู ูููุงุช PDF ูุฎุชููุฉ ุงูุฃุญุฌุงู
2. **ุฑุงูุจ ุงูุฃุฏุงุก** ุจุงุณุชุฎุฏุงู ุงูุฃุฏูุงุช ุงููุฏูุฌุฉ
3. **ุดุงุฑู ุงูุชุญุณููุงุช** ูุน ูุฑูู ุงูุชุทููุฑ
4. **ุทุจู ููุณ ุงููุจุงุฏุฆ** ุนูู ุฃุฏูุงุช ุฃุฎุฑู ูู ุงูุชุทุจูู

**ุชู ุฅูุฌุงุฒ ุฌููุน ุงูุชุญุณููุงุช ุจูุฌุงุญ! ๐ฏ**