<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF.js Debug - ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© PDF.js</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ” PDF.js Debug Tool - Ø£Ø¯Ø§Ø© ØªØ´Ø®ÙŠØµ PDF.js</h1>
    
    <div id="status" class="status info">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© PDF.js...</div>
    
    <div>
        <button class="btn-primary" onclick="checkStatus()">ğŸ”„ ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©</button>
        <button class="btn-secondary" onclick="testLoad()">ğŸ“¥ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
        <button class="btn-danger" onclick="clearLogs()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
    </div>
    
    <h2>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø©</h2>
    <pre id="details">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</pre>
    
    <h2>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h2>
    <pre id="logs"></pre>

    <!-- Load PDF.js -->
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    
    <script>
        const statusDiv = document.getElementById('status');
        const detailsDiv = document.getElementById('details');
        const logsDiv = document.getElementById('logs');
        
        let logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logs.push(logEntry);
            console.log(logEntry);
            updateLogsDisplay();
        }
        
        function updateLogsDisplay() {
            logsDiv.textContent = logs.join('\n');
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        function clearLogs() {
            logs = [];
            updateLogsDisplay();
        }
        
        function updateStatus(message, className = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${className}`;
            log(message, className);
        }
        
        function checkPdfJsStatus() {
            const info = {
                windowExists: typeof window !== 'undefined',
                pdfjsLibExists: typeof window.pdfjsLib !== 'undefined',
                version: window.pdfjsLib?.version || 'ØºÙŠØ± Ù…ØªØ§Ø­',
                globalWorkerOptions: typeof window.pdfjsLib?.GlobalWorkerOptions !== 'undefined',
                getDocument: typeof window.pdfjsLib?.getDocument === 'function',
                workerSrc: window.pdfjsLib?.GlobalWorkerOptions?.workerSrc || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                scriptTags: document.querySelectorAll('script[src*="pdf"]').length
            };
            
            return info;
        }
        
        function checkStatus() {
            log('Ø¨Ø¯Ø¡ ÙØ­Øµ Ø­Ø§Ù„Ø© PDF.js...');
            
            const status = checkPdfJsStatus();
            
            let details = 'ØªÙØ§ØµÙŠÙ„ Ø­Ø§Ù„Ø© PDF.js:\n';
            details += `- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØªØµÙØ­ Ù…ØªØ§Ø­Ø©: ${status.windowExists ? 'âœ…' : 'âŒ'}\n`;
            details += `- Ù…ÙƒØªØ¨Ø© PDF.js Ù…Ø­Ù…Ù„Ø©: ${status.pdfjsLibExists ? 'âœ…' : 'âŒ'}\n`;
            details += `- Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${status.version}\n`;
            details += `- GlobalWorkerOptions Ù…ØªØ§Ø­: ${status.globalWorkerOptions ? 'âœ…' : 'âŒ'}\n`;
            details += `- Ø¯Ø§Ù„Ø© getDocument Ù…ØªØ§Ø­Ø©: ${status.getDocument ? 'âœ…' : 'âŒ'}\n`;
            details += `- Ù…Ø³Ø§Ø± Worker: ${status.workerSrc}\n`;
            details += `- Ø¹Ø¯Ø¯ script tags Ù„Ù„Ù€ PDF: ${status.scriptTags}\n`;
            
            // Check network
            details += `\nÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©:\n`;
            details += `- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${navigator.onLine ? 'âœ… Ù…ØªØµÙ„' : 'âŒ ØºÙŠØ± Ù…ØªØµÙ„'}\n`;
            details += `- User Agent: ${navigator.userAgent}\n`;
            
            detailsDiv.textContent = details;
            
            // Determine overall status
            if (status.pdfjsLibExists && status.globalWorkerOptions && status.getDocument) {
                if (status.workerSrc && status.workerSrc !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') {
                    updateStatus('âœ… PDF.js Ù…Ø­Ù…Ù„ ÙˆÙ…ÙØ¹Ø¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!', 'success');
                } else {
                    updateStatus('âš ï¸ PDF.js Ù…Ø­Ù…Ù„ Ù„ÙƒÙ† Worker ØºÙŠØ± Ù…ÙØ¹Ø¯', 'warning');
                }
            } else if (status.pdfjsLibExists) {
                updateStatus('âš ï¸ PDF.js Ù…Ø­Ù…Ù„ Ø¬Ø²Ø¦ÙŠØ§Ù‹ - Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø©', 'warning');
            } else {
                updateStatus('âŒ PDF.js ØºÙŠØ± Ù…Ø­Ù…Ù„', 'error');
            }
        }
        
        function testLoad() {
            log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ PDF.js...');
            updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...', 'info');
            
            let attempts = 0;
            const maxAttempts = 20;
            
            const testInterval = setInterval(() => {
                attempts++;
                log(`Ù…Ø­Ø§ÙˆÙ„Ø© ${attempts}/${maxAttempts}`);
                
                const status = checkPdfJsStatus();
                
                if (status.pdfjsLibExists && status.globalWorkerOptions && status.getDocument) {
                    clearInterval(testInterval);
                    
                    // Configure worker if not set
                    if (!status.workerSrc || status.workerSrc === 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') {
                        window.pdfjsLib.GlobalWorkerOptions.workerSrc = 
                            'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
                        log('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø§Ø± Worker');
                    }
                    
                    updateStatus('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ PDF.js Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    checkStatus(); // Update details
                    return;
                }
                
                if (attempts >= maxAttempts) {
                    clearInterval(testInterval);
                    updateStatus('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ PDF.js Ø¨Ø¹Ø¯ Ø¹Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø§Øª', 'error');
                    
                    // Additional debugging
                    log('ÙØ­Øµ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡...');
                    
                    // Check if script loaded but failed to execute
                    const scripts = document.querySelectorAll('script[src*="pdf"]');
                    log(`Ø¹Ø¯Ø¯ script tags Ù„Ù„Ù€ PDF: ${scripts.length}`);
                    
                    scripts.forEach((script, index) => {
                        log(`Script ${index + 1}: ${script.src}`);
                        log(`- loaded: ${script.readyState || 'unknown'}`);
                    });
                    
                    // Check console errors
                    log('ÙŠØ±Ø¬Ù‰ ÙØ­Øµ console Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©');
                }
            }, 500);
        }
        
        // Auto-start check
        setTimeout(() => {
            log('Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ...');
            checkStatus();
        }, 1000);
        
        // Monitor script loading
        document.addEventListener('DOMContentLoaded', () => {
            log('DOM Ù…Ø­Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
        });
        
        window.addEventListener('load', () => {
            log('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù…Ø­Ù…Ù„Ø©');
            setTimeout(checkStatus, 500);
        });
        
        // Monitor PDF.js loading
        let checkCount = 0;
        const monitorInterval = setInterval(() => {
            checkCount++;
            if (typeof window.pdfjsLib !== 'undefined') {
                log(`PDF.js ØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡ Ø¨Ø¹Ø¯ ${checkCount * 100}ms`);
                clearInterval(monitorInterval);
                setTimeout(checkStatus, 100);
            } else if (checkCount > 100) { // 10 seconds
                log('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ PDF.js');
                clearInterval(monitorInterval);
            }
        }, 100);
    </script>
</body>
</html>